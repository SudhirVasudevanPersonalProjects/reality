# Story 2.4 PATCH: Chamber Mind Categories & Why Field

## Status

Done
**Priority**: IMPLEMENT THIS BEFORE STORY 2.8

**Why This Matters**: Story 2.8 (Mind Card View) depends on this patch to capture the data it will display. Chamber must capture `mind_category`, `why`, and desire-specific attributes before Mind cards can show them.

## Purpose

**Patch Story 2.4** (Chamber Organization) to add Mind Category selection (Experience/Thought/Desire) and "Why" field when organizing Mind somethings. This supports the unified Mind's Abode architecture where somethings are categorized by temporal dimension and meaning.

## Context

**Original Story 2.4** implemented basic Physical vs Mind selection in the Chamber. This patch extends the Mind organization flow to support the three temporal categories (Experience/Thought/Desire) and the critical "Why" field that differentiates organized somethings from the "Somewhere" abode.

**Related Stories**:
- Story 2.4 (original): Chamber Organization - Physical vs Mind Selection
- Story 2.8: Mind Card View - displays category badges and why field

---

## Acceptance Criteria

### **AC1: Mind Category Dropdown** (NEW)

When user selects "Mind Experience" in Chamber:

1. **Show Mind Category Dropdown** below Physical/Mind radio buttons:
   - Label: "What kind of Mind something is this?"
   - Options:
     - ğŸ­ **Experience** (Past Memory) - "A captured moment, event, or memory"
     - ğŸ’­ **Thought** (Present Reflection) - "A reflection, insight, or question"
     - âœ¨ **Desire** (Future Aspiration) - "A want, goal, or aspiration"
   - Default: Pre-selected based on content heuristics (optional):
     - Has media + location â†’ Experience
     - No media, abstract text â†’ Thought
     - Contains "I want", "goal", "wish" â†’ Desire
     - If unsure â†’ Thought (safe default)

2. **Helper Text** for each option:
   - Experience: "Something that happened - a memory, event, or moment in time"
   - Thought: "A reflection, insight, question, or analysis about something"
   - Desire: "Something you want - a goal, aspiration, or future intention"

3. **Dropdown Styling**:
   - Dark theme matching Chamber aesthetic
   - Large touch targets for mobile (48px min)
   - Emoji icons visible alongside labels
   - Semantic description in smaller text below each option

### **AC2: "Why This Matters" Field** (NEW)

For ALL Mind somethings (Experience/Thought/Desire):

1. **Show "Why" Textarea** after Mind Category selection:
   - Label: "Why does this matter to you?" (optional but encouraged)
   - Placeholder text varies by category:
     - Experience: "What makes this memory meaningful? How did it shape you?"
     - Thought: "Why is this thought important? What does it reveal?"
     - Desire: "Why do you want this? What deeper need does it fulfill?"
   - Multiline textarea (min 3 rows, auto-expand)
   - Character limit: 1000 characters (generous for depth)

2. **Validation**:
   - Field is **optional** (can skip and stay in "Somewhere" abode)
   - If filled â†’ something moves to organized sun universe (Beauty/Ugly/Dreams)
   - If empty â†’ something stays in "Somewhere" (unorganized abode)

3. **Visual Indicator**:
   - Show badge: "ğŸ—‘ï¸ Somewhere" if why field is empty
   - Show badge: "âœ¨ Organized" if why field has content
   - Explanation: "Having a 'why' gives this meaning - without it, it stays in 'Somewhere' until you're ready to organize it."

### **AC3: Desire-Specific Fields** (CONDITIONAL)

If user selects category = "Desire", show additional optional fields:

1. **Intensity Slider** (optional):
   - Label: "How strong is this desire?"
   - Range: 0.0 (mild interest) â†’ 1.0 (burning need)
   - Visual labels: Mild | Moderate | Strong | Intense
   - Default: 0.5 (moderate)
   - Saved as `attributes.desire_intensity`

2. **Status Dropdown** (optional):
   - Label: "Where is this desire in its journey?"
   - Options:
     - Nascent - "Just discovered this want"
     - Active - "Actively pursuing this"
     - Fulfilled - "Already achieved" (rare in Chamber, usually marked later)
   - Default: Nascent
   - Saved as `attributes.desire_status`

3. **Helper Text**:
   - "These help you track the lifecycle of your desires - but they're optional. You can always add them later from the card view."

### **AC4: Updated API Endpoint**

Modify `/api/somethings/[id]/organize` to accept:

```typescript
{
  realm: 'mind',
  care: 1-5,

  // NEW: Mind category
  attributes: {
    mind_category: 'experience' | 'thought' | 'desire',
    why?: string,  // Optional, but key for organization

    // Desire-specific (optional)
    desire_intensity?: number,  // 0.0-1.0
    desire_status?: 'nascent' | 'active' | 'fulfilled',

    // Sun/Domain (default to 'somewhere' if no why)
    sun_domain: string  // Automatically set: 'somewhere' if !why, else null (user assigns sun later)
  }
}
```

### **AC5: Chamber State Management**

1. **Track additional state**:
   ```typescript
   const [mindCategory, setMindCategory] = useState<'experience' | 'thought' | 'desire'>('thought')
   const [why, setWhy] = useState<string>('')
   const [desireIntensity, setDesireIntensity] = useState<number>(0.5)
   const [desireStatus, setDesireStatus] = useState<string>('nascent')
   ```

2. **Conditional UI Rendering**:
   - Mind Category dropdown only shown if realm = 'mind'
   - Why field shown for all Mind categories
   - Desire fields only shown if mindCategory = 'desire'

3. **Reset on Skip**:
   - If user clicks "Skip", clear all fields and fetch next something

### **AC6: Updated Chamber UI Layout**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Chamber of Reflection                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Current Something]                            â”‚
â”‚  Text: "Coffee with Sarah at Philz"             â”‚
â”‚  Media: [photo1.jpg]                            â”‚
â”‚  Captured: Nov 6, 2025 3:45 PM                  â”‚
â”‚                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                 â”‚
â”‚  This is a:                                     â”‚
â”‚  â—‹ Physical Experience (location-based)         â”‚
â”‚  â— Mind Experience (thought/reflection)         â”‚  â† Selected
â”‚                                                 â”‚
â”‚  â”€â”€â”€ MIND CATEGORY â”€â”€â”€                          â”‚  â† NEW SECTION
â”‚  What kind of Mind something is this?           â”‚
â”‚                                                 â”‚
â”‚  [Dropdown â–¼]                                   â”‚
â”‚  â— ğŸ­ Experience (Past Memory)                  â”‚  â† Selected
â”‚    â—‹ ğŸ’­ Thought (Present Reflection)           â”‚
â”‚    â—‹ âœ¨ Desire (Future Aspiration)             â”‚
â”‚                                                 â”‚
â”‚  Helper: "Something that happened - a memory,   â”‚
â”‚           event, or moment in time"             â”‚
â”‚                                                 â”‚
â”‚  â”€â”€â”€ WHY THIS MATTERS â”€â”€â”€                       â”‚  â† NEW SECTION
â”‚  Why does this matter to you? (optional)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ What makes this memory meaningful?        â”‚ â”‚
â”‚  â”‚ How did it shape you?                     â”‚ â”‚
â”‚  â”‚                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚  ğŸ—‘ï¸ Somewhere (will stay unorganized until     â”‚  â† Indicator
â”‚     you add a "why")                            â”‚
â”‚                                                 â”‚
â”‚  â”€â”€â”€ IF LINKED TO PHYSICAL â”€â”€â”€                  â”‚
â”‚  ğŸ“ Related Location: [Search or select...]     â”‚
â”‚                                                 â”‚
â”‚  â”€â”€â”€ CARE â”€â”€â”€                                   â”‚
â”‚  â¤ï¸  Care: ğŸ˜ âš«âš«âš«âšªâšª ğŸ˜  (Hate â†’ Love)        â”‚
â”‚                                                 â”‚
â”‚  ğŸ·ï¸  Tags: [#coffee #social] + Add             â”‚
â”‚                                                 â”‚
â”‚  [Skip] [Organize & Continue]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Tasks / Subtasks

- [x] **Task 1: Update Chamber UI Component** (`app/chamber/ChamberClient.tsx`)
  - [x] Add state for `mindCategory`, `why`, `desireIntensity`, `desireStatus`
  - [x] Create Mind Category Dropdown component
  - [x] Add category helper text
  - [x] Implement dropdown change handler
  - [x] Show/hide dropdown based on realm selection

- [x] **Task 2: Create "Why" Field Component**
  - [x] Implement auto-expanding textarea
  - [x] Add character counter (1000 char limit)
  - [x] Dynamic placeholder based on category
  - [x] Show "Somewhere" vs "Organized" indicator based on content

- [x] **Task 3: Create Desire-Specific Fields** (conditional)
  - [x] Implement intensity slider with visual labels
  - [x] Implement status dropdown (Nascent/Active/Fulfilled)
  - [x] Add helper text
  - [x] Conditional rendering: only show if mindCategory = 'desire'

- [x] **Task 4: Update Organization API**
  - [x] Modify `app/api/somethings/[id]/organize/route.ts`
  - [x] Accept `attributes.mind_category` field
  - [x] Accept `attributes.why` field
  - [x] Accept `attributes.desire_intensity` field (optional)
  - [x] Accept `attributes.desire_status` field (optional)
  - [x] Auto-set `attributes.sun_domain = 'somewhere'` if why is empty

- [x] **Task 5: Update Validation Schema**
  - [x] Modify `lib/schemas/organization.ts`
  - [x] Add mind_category validation (enum: experience/thought/desire)
  - [x] Add why field (string, max 1000 chars, optional)
  - [x] Add desire_intensity (number 0.0-1.0, optional)
  - [x] Add desire_status (enum: nascent/active/fulfilled, optional)

- [x] **Task 6: Write Unit Tests**
  - [x] Test Mind Category dropdown renders for Mind somethings
  - [x] Test dropdown doesn't render for Physical somethings
  - [x] Test Why field shows for all Mind categories
  - [x] Test Desire fields only show for category = 'desire'
  - [x] Test sun_domain set to 'somewhere' when why is empty
  - [x] Test API accepts new fields
  - [x] Test validation schema

- [ ] **Task 7: Manual Testing**
  - [ ] Test: Select Mind â†’ Category dropdown appears
  - [ ] Test: Select each category â†’ Helper text changes
  - [ ] Test: Select Desire â†’ Intensity/Status fields appear
  - [ ] Test: Fill why field â†’ "Organized" badge shows
  - [ ] Test: Leave why empty â†’ "Somewhere" badge shows
  - [ ] Test: Organize with all fields â†’ Data saves correctly
  - [ ] Test: View organized card in Story 2.8 â†’ Category badge shows

---

## Implementation Notes

### Category Heuristics (Optional Smart Defaults)

**Experience Detection**:
```typescript
function guessCategory(something: Something): Category {
  const hasMedia = !!something.media_url
  const hasLocation = !!something.latitude
  const text = something.text_content?.toLowerCase() || ''

  // Experience indicators
  if (hasMedia && hasLocation) return 'experience'
  if (text.match(/\b(I (saw|went|visited|met|did)|today|yesterday)\b/)) return 'experience'

  // Desire indicators
  if (text.match(/\b(I want|I wish|I hope|goal|dream|aspire)\b/)) return 'desire'

  // Thought indicators (questions, analysis)
  if (text.match(/\b(why|how|what if|I think|I wonder|realize)\b/)) return 'thought'

  // Default to thought (safest)
  return 'thought'
}
```

### Why Field Placeholders

```typescript
const WHY_PLACEHOLDERS = {
  experience: "What makes this memory meaningful? How did it shape you?",
  thought: "Why is this thought important? What does it reveal?",
  desire: "Why do you want this? What deeper need does it fulfill?"
}
```

### Sun Domain Auto-Assignment

```typescript
// In API handler
const sunDomain = attributes.why ? null : 'somewhere'

// null = user will assign sun later (Beauty/Ugly/Dreams/custom)
// 'somewhere' = stays unorganized until why is added
```

---

## Dev Agent Record

### Debug Log

- No blocking issues encountered
- All tasks completed successfully
- Build and lint passed with only pre-existing warnings

### Completion Notes

- Implemented mind category selection with radio buttons (Experience/Thought/Desire)
- Added smart category detection based on content heuristics
- Created "Why" field with dynamic placeholders and character counter
- Implemented desire-specific fields (intensity slider and status dropdown)
- Updated organization schema to validate new attributes
- Updated organization API to save attributes to database
- Created comprehensive test suites for UI and API
- Fixed ESLint errors for unescaped quotes

### File List

- `app/chamber/ChamberClient.tsx` - Updated with mind category UI
- `app/api/somethings/[id]/organize/route.ts` - Updated to accept attributes
- `lib/schemas/organization.ts` - Updated validation schema
- `tests/api/organize-mind-categories.test.ts` - API tests (NEW)
- `tests/chamber/mind-category-ui.test.tsx` - UI tests (NEW)

### Change Log (Dev)

| Date | Change | Files |
|------|--------|-------|
| 2025-11-07 | Added mind category state and UI components | ChamberClient.tsx |
| 2025-11-07 | Updated payload to include attributes | ChamberClient.tsx |
| 2025-11-07 | Updated organization schema | organization.ts |
| 2025-11-07 | Updated API to save attributes | organize/route.ts |
| 2025-11-07 | Created test suites | organize-mind-categories.test.ts, mind-category-ui.test.tsx |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-06 | 1.0 | Patch to Story 2.4: Add Mind categories and Why field | SM Bob |

---

## Relationship to Other Stories

- **Story 2.4 (original)**: Base Chamber UI with Physical/Mind selection
- **Story 2.8**: Mind Card View displays category badges and why field
- **Epic 3**: Connections creation (links why field to other somethings)
- **Future**: Sun organization (Beauty/Ugly/Dreams) - moves somethings out of "Somewhere"

---

**This patch completes the Mind's Abode foundation for Epic 2.** ğŸƒ
