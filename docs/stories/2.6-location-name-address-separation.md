# Story 2.6: Separate Location Name & Address Fields

## Status

Done

## Story

**As a** user,
**I want** to enter my personal location label separately from the geocoding address,
**so that** my custom location names (e.g., "Price Center") are preserved while still capturing precise coordinates.

## Acceptance Criteria

1. **Two Separate Input Fields**: Location input redesigned with two distinct fields:
   - "Location Name" (user's personal label, REQUIRED for Physical realm)
   - "Address/Coordinates" (optional geocoding field)

2. **Location Name Field**:
   - Text input for user's custom label (e.g., "Price Center", "Papa Johns", "My Favorite Spot")
   - REQUIRED for Physical realm (validation error if empty)
   - Never auto-populated or overwritten by Mapbox selections
   - Saved directly to `location_name` database column

3. **Address/Coordinates Field**:
   - Mapbox autocomplete search (from Story 2.5) OR manual coordinate entry
   - Optional (can be left blank with warning)
   - Two input modes:
     - **Mode A**: Mapbox search with autocomplete dropdown
     - **Mode B**: Manual lat/lng number inputs

4. **Mapbox Selection Behavior**:
   - When user selects Mapbox suggestion, populate ONLY address field
   - Location Name field remains unchanged with user's original input
   - Capture: `latitude`, `longitude`, `formatted_address` (as in Story 2.5)

5. **Manual Coordinate Entry**:
   - Two number inputs: Latitude (-90 to 90), Longitude (-180 to 180)
   - Validate ranges before submission
   - When manual coords entered: `formatted_address` = NULL
   - Toggle between "Search Address" mode and "Enter Coordinates" mode

6. **UI Mode Toggle**:
   - Button/link to switch between Mapbox search and manual coordinate entry
   - Default: Mapbox search mode
   - Toggle text: "Enter coordinates manually" â†” "Search by address"

7. **Database Storage**:
   - `location_name`: User's personal label (always populated for Physical)
   - `latitude`, `longitude`: From Mapbox OR manual entry
   - `formatted_address`: From Mapbox only (NULL if manual coords)

8. **Backward Compatibility**:
   - Existing Physical somethings with `location_name` remain unchanged
   - No migration required (fields already exist from Story 2.5)

9. **Warning Messages**:
   - If address/coordinates left blank: "âš ï¸ No coordinates captured. Your location won't appear on the map until geocoded."
   - If invalid manual coordinates: "âš ï¸ Invalid coordinates. Latitude must be -90 to 90, Longitude must be -180 to 180."

10. **State Management**:
    - Separate state for `locationName` (user input) and `addressSearch` (geocoding input)
    - Clear address field when realm changes from Physical to Mind
    - Preserve location name when switching modes (search â†” manual)

## Tasks / Subtasks

- [x] **Task 1: Update LocationInput Component UI** (AC: 1, 2, 3, 6)
  - [x] Rename existing component to `AddressSearchInput.tsx` (handles Mapbox autocomplete only)
  - [x] Create new `LocationInput.tsx` wrapper component with two fields
  - [x] Add "Location Name" text input (required, no autocomplete)
  - [x] Add mode toggle button ("Search Address" â†” "Enter Coordinates")
  - [x] Conditionally render `AddressSearchInput` OR `ManualCoordinateInput` based on mode

- [x] **Task 2: Create ManualCoordinateInput Component** (AC: 5)
  - [x] Create `app/components/ManualCoordinateInput.tsx`
  - [x] Two number inputs: Latitude, Longitude
  - [x] Validation: latitude (-90 to 90), longitude (-180 to 180)
  - [x] Callback: `onCoordinatesEnter({ latitude, longitude })`
  - [x] Display validation errors inline

- [x] **Task 3: Update ChamberClient State Management** (AC: 4, 10)
  - [x] Modify `app/chamber/ChamberClient.tsx`
  - [x] Add separate state: `addressSearch` (for geocoding field, separate from `locationName`)
  - [x] Add state: `coordinateMode` ('search' | 'manual')
  - [x] Update `handleLocationSelect` to populate coordinates WITHOUT changing `locationName`
  - [x] Add `handleManualCoordinates` to accept manual lat/lng
  - [x] Clear `addressSearch` when realm changes to Mind (keep `locationName` clearing as-is)

- [x] **Task 4: Update Organize API Validation** (AC: 2, 7)
  - [x] Modify `lib/schemas/organization.ts`
  - [x] Update Zod schema: `location_name` REQUIRED for Physical (no change from Story 2.5)
  - [x] Coordinates remain optional (Story 2.5 Option 2 behavior preserved)
  - [x] Ensure `formatted_address` can be NULL when manual coordinates provided

- [x] **Task 5: Update Warning Messages** (AC: 9)
  - [x] Modify `app/chamber/ChamberClient.tsx`
  - [x] Update warning logic to check if coordinates missing (regardless of mode)
  - [x] Add validation error for invalid manual coordinates

- [x] **Task 6: Update UI Styling** (AC: 1, 6)
  - [x] Style two-field layout with clear visual separation
  - [x] Mode toggle button styling (active/inactive states)
  - [x] Ensure mobile responsiveness
  - [x] Match existing Chamber dark theme

- [x] **Task 7: Write Unit Tests** (AC: All)
  - [x] Create `tests/components/location-input-wrapper.test.tsx`
    - Test Location Name field is required for Physical
    - Test Location Name is NOT overwritten by Mapbox selection
    - Test mode toggle switches between search and manual
  - [x] Create `tests/components/manual-coordinate-input.test.tsx`
    - Test latitude validation (-90 to 90)
    - Test longitude validation (-180 to 180)
    - Test callback fires with correct data
  - [x] Update `tests/chamber/organize-with-coordinates.test.ts`
    - Test manual coordinates accepted (formatted_address = NULL)
    - Test location_name validation for Physical realm

- [X] **Task 8: Manual Testing** (AC: All)
  - [X] Test Scenario 1: User enters "Price Center" â†’ searches "Student Center UCSD" â†’ verifies location_name="Price Center", formatted_address="Student Center..."
  - [X] Test Scenario 2: User enters "My Favorite Beach" â†’ manually enters lat/lng from Google Maps â†’ verifies coordinates saved, formatted_address=NULL
  - [X] Test Scenario 3: Switch between search and manual modes â†’ verify state preserved

## Dev Notes

### Epic Context

**Epic 2 Goal**: Build separate Physical and Mind abode layers with care-based organization.

[Source: docs/epic-2-brainstorming.md, lines 9-31]

**Story 2.6 Position**: UX refinement for Story 2.5. Addresses limitation where Mapbox autocomplete overwrites user's personal location labels. This is a short, focused fix to separate user labels from geocoding.

### Story 2.5 â†’ 2.6 Connection (UX Improvement)

**Problem Identified in Story 2.5**:
- User types personal label: "Price Center"
- Selects Mapbox suggestion: "Student Center, UC San Diego, La Jolla, CA 92037"
- Result: `location_name` gets overwritten to "Student Center, UC San Diego..."
- **Lost**: User's personal label "Price Center"

[Source: QA review conversation with Quinn, 2025-11-05]

**Story 2.6 Solution**:
```typescript
// BEFORE (Story 2.5):
User Input: "Price Center" â†’ [Mapbox Search]
  â†“ (selects "Student Center, UCSD...")
location_name: "Student Center, UC San Diego, La Jolla, CA 92037"  âŒ Overwritten!

// AFTER (Story 2.6):
Location Name: "Price Center"  â† Separate field, NEVER changes
Address/Coords: [Search "Student Center UCSD" OR Manual: 32.88, -117.23]
  â†“
location_name: "Price Center"          âœ… Preserved!
formatted_address: "Student Center..."  âœ… Geocoded address
latitude: 32.8810
longitude: -117.2340
```

### Component Architecture

**Current (Story 2.5)**:
```
ChamberClient.tsx
  â””â”€ LocationInput.tsx (Mapbox autocomplete + location_name)
       â””â”€ lib/mapbox/geocoding.ts
```

**New (Story 2.6)**:
```
ChamberClient.tsx
  â””â”€ LocationInput.tsx (Wrapper with two fields + mode toggle)
       â”œâ”€ Text Input: "Location Name" (user label, required)
       â””â”€ Conditional:
            â”œâ”€ AddressSearchInput.tsx (Mapbox autocomplete, renamed from old LocationInput)
            â”‚    â””â”€ lib/mapbox/geocoding.ts
            â””â”€ ManualCoordinateInput.tsx (lat/lng number inputs, NEW)
```

### File Structure

```
app/
â”œâ”€â”€ chamber/
â”‚   â””â”€â”€ ChamberClient.tsx                â† MODIFY (add addressSearch state, mode toggle)
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ LocationInput.tsx                â† MODIFY (becomes wrapper with two fields)
â”‚   â”œâ”€â”€ AddressSearchInput.tsx           â† RENAME from old LocationInput.tsx
â”‚   â””â”€â”€ ManualCoordinateInput.tsx        â† NEW (lat/lng number inputs)
lib/
â”œâ”€â”€ schemas/
â”‚   â””â”€â”€ organization.ts                  â† VERIFY (location_name required for Physical)
â””â”€â”€ mapbox/
    â””â”€â”€ geocoding.ts                     â† NO CHANGE (used by AddressSearchInput)
tests/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ location-input-wrapper.test.tsx  â† NEW (wrapper component tests)
â”‚   â””â”€â”€ manual-coordinate-input.test.tsx â† NEW (manual coords tests)
â””â”€â”€ chamber/
    â””â”€â”€ organize-with-coordinates.test.ts â† UPDATE (add manual coords test)
```

### UI Layout (Chamber Page)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chamber of Reflection                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Capture Content Display]                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Organization Panel:                                     â”‚
â”‚                                                          â”‚
â”‚ â—‹ Physical Experience    â—‹ Mind Experience              â”‚
â”‚                                                          â”‚
â”‚ ğŸ“ Location Name (Your Label)  *required                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Price Center                                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚ ğŸ“ Address/Coordinates (for map)                        â”‚
â”‚ [Search by address â†” Enter coordinates manually]        â”‚
â”‚                                                          â”‚
â”‚ Mode: Search                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Student Center, UCSD...                     [â†“]    â”‚ â”‚ â† Mapbox autocomplete
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ Suggestions:                                            â”‚
â”‚ â€¢ Student Center, UC San Diego, La Jolla, CA            â”‚
â”‚ â€¢ Price Center West, UCSD, La Jolla, CA                 â”‚
â”‚                                                          â”‚
â”‚ OR Mode: Manual                                         â”‚
â”‚ Latitude:  [32.8810___]   Longitude: [-117.2340___]    â”‚
â”‚                                                          â”‚
â”‚ â¤ï¸ Care: [Slider 1-5]                                   â”‚
â”‚                                                          â”‚
â”‚ [Organize & Continue]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Management Pattern

**ChamberClient.tsx State**:
```typescript
// User's personal label (REQUIRED for Physical)
const [locationName, setLocationName] = useState('')

// Geocoding field (optional)
const [addressSearch, setAddressSearch] = useState('')

// Coordinate mode
const [coordinateMode, setCoordinateMode] = useState<'search' | 'manual'>('search')

// Coordinates (from Mapbox OR manual)
const [latitude, setLatitude] = useState<number | null>(null)
const [longitude, setLongitude] = useState<number | null>(null)
const [formattedAddress, setFormattedAddress] = useState('')

// Mapbox selection handler (from AddressSearchInput)
const handleAddressSelect = (data: LocationData) => {
  // DO NOT change locationName!
  setLatitude(data.latitude)
  setLongitude(data.longitude)
  setFormattedAddress(data.formattedAddress)
  setAddressSearch(data.placeName) // populate search field only
}

// Manual coordinate handler (from ManualCoordinateInput)
const handleManualCoordinates = (lat: number, lng: number) => {
  setLatitude(lat)
  setLongitude(lng)
  setFormattedAddress('') // NULL when manual
}
```

### Database Schema (No Changes Required)

Story 2.5 already created the necessary columns:
- `location_name TEXT` â† User's personal label
- `latitude DECIMAL(10,8)` â† From Mapbox OR manual
- `longitude DECIMAL(11,8)` â† From Mapbox OR manual
- `formatted_address TEXT` â† From Mapbox only (NULL if manual)

**No migration needed** - this is purely a UI/UX change.

[Source: Story 2.5, supabase/migrations/20251105000001_add_location_fields.sql]

### Validation Rules

**Location Name** (new enforcement):
```typescript
// lib/schemas/organization.ts (Story 2.5 already has this)
location_name: z.string().min(1).optional()

// With refinement for Physical realm:
.refine(
  (data) => {
    if (data.realm === 'physical' && !data.location_name) {
      return false
    }
    return true
  },
  { message: 'Location name is required for physical experiences' }
)
```

**Manual Coordinates** (new validation):
```typescript
// In ManualCoordinateInput component
const validateLatitude = (lat: number) => {
  if (lat < -90 || lat > 90) {
    return 'Latitude must be between -90 and 90'
  }
  return null
}

const validateLongitude = (lng: number) => {
  if (lng < -180 || lng > 180) {
    return 'Longitude must be between -180 and 180'
  }
  return null
}
```

### User Flows

**Flow 1: Mapbox Search Mode**
1. User enters Location Name: "Price Center"
2. User clicks "Search by address"
3. User types in Address field: "Student Center UCSD"
4. Mapbox shows suggestions
5. User selects "Student Center, UC San Diego, La Jolla, CA 92037"
6. Result:
   - `location_name`: "Price Center" â† Preserved!
   - `formatted_address`: "Student Center, UC San Diego, La Jolla, CA 92037"
   - `latitude`: 32.8810, `longitude`: -117.2340

**Flow 2: Manual Coordinate Entry**
1. User enters Location Name: "My Favorite Beach"
2. User clicks "Enter coordinates manually"
3. User opens Google Maps, finds location, copies lat/lng
4. User enters: Latitude: 32.7157, Longitude: -117.1611
5. Result:
   - `location_name`: "My Favorite Beach"
   - `formatted_address`: NULL
   - `latitude`: 32.7157, `longitude`: -117.1611

**Flow 3: No Coordinates (Warning)**
1. User enters Location Name: "Obscure Location"
2. User leaves Address/Coordinates blank
3. User clicks "Organize & Continue"
4. Warning: "âš ï¸ No coordinates captured..."
5. Submission succeeds (Story 2.5 Option 2 behavior)
6. Result:
   - `location_name`: "Obscure Location"
   - `formatted_address`: NULL
   - `latitude`: NULL, `longitude`: NULL

### Testing

**Test Framework**: Vitest (fast, TypeScript-native)

[Source: docs/prd.md, lines 743-748 - Testing Requirements]

**Test Standards** (From Story 2.4/2.5):
- Test files in `tests/` directory (not colocated with source)
- Mock Mapbox client for geocoding tests
- Test both happy path and error cases
- Descriptive test names: `describe('Feature') { it('should do X when Y') }`

**Required Test Coverage**:

1. **LocationInput Wrapper** (`tests/components/location-input-wrapper.test.tsx`):
   - Location Name field renders and is required for Physical
   - Location Name NOT overwritten when Mapbox selection occurs
   - Mode toggle switches between search and manual
   - State preserved when switching modes

2. **ManualCoordinateInput** (`tests/components/manual-coordinate-input.test.tsx`):
   - Validates latitude range (-90 to 90)
   - Validates longitude range (-180 to 180)
   - Fires callback with correct coordinate data
   - Displays validation errors

3. **Organize API** (`tests/chamber/organize-with-coordinates.test.ts` updates):
   - Accepts manual coordinates with formatted_address=NULL
   - Validates location_name required for Physical realm

### Accessibility

**WCAG 2.1 AA Compliance** (maintained from Story 2.5):
- All inputs have `<label>` elements with clear text
- Mode toggle button has clear text (not just icons)
- Number inputs have `type="number"` with `min`/`max` attributes
- Validation errors announced to screen readers
- Keyboard navigation: Tab between fields, Enter to submit

[Source: Story 2.5, AC16 - Accessibility Requirements]

### Performance

No performance impact expected:
- No new API calls (Mapbox usage same as Story 2.5)
- Minimal additional state variables
- Component split improves code maintainability

### Future Enhancements (Out of Scope)

**Defer to Epic 4**:
- LLM-enhanced geocoding (web search for business names)
- Location history/favorites
- Geocoding suggestions based on user's previous locations

**Defer to Story 2.7**:
- Display formatted_address vs location_name on map markers

## Testing

**Test Framework**: Vitest (fast, TypeScript-native)

**Test Standards**:
- Test files in `tests/` directory (not colocated)
- Mock Mapbox client for geocoding tests
- Test both happy path and error cases
- Descriptive test names

**Required Coverage**:
- LocationInput wrapper component (mode toggle, location name preservation)
- ManualCoordinateInput validation
- Updated organize API tests

[Source: docs/prd.md, lines 743-748]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-05 | 1.0 | Initial draft - Separate location name and address fields UX fix | SM Bob |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References
None required - straightforward implementation

### Completion Notes
1. **Component Architecture**:
   - Renamed `LocationInput.tsx` â†’ `AddressSearchInput.tsx` (Mapbox autocomplete only)
   - Created new `LocationInput.tsx` wrapper with two separate fields
   - Created `ManualCoordinateInput.tsx` for lat/lng entry with validation

2. **State Management**:
   - Updated `ChamberClient.tsx` with handlers: `handleAddressSelect` (preserves location name), `handleManualCoordinates`
   - Location name field completely separate from address/coordinate inputs
   - Mode toggle state manages 'search' vs 'manual' coordinate entry

3. **Key Implementation Details**:
   - Location name is NEVER overwritten by Mapbox selections (core UX fix)
   - Manual coordinate validation: lat (-90 to 90), lng (-180 to 180)
   - `formatted_address` is NULL when manual coordinates used
   - Existing validation schema from Story 2.5 requires no changes

4. **Testing**:
   - 22 tests pass: wrapper component (7), manual coordinates (7), organize API (8)
   - Removed obsolete `location-input-autocomplete.test.tsx` (replaced by wrapper tests)
   - All Story 2.6 acceptance criteria covered by tests

5. **Build**:
   - âœ“ TypeScript compilation successful
   - âœ“ Next.js build successful
   - Only warnings: existing ESLint issues (unrelated to this story)

### File List
**Created:**
- `app/components/ManualCoordinateInput.tsx`
- `tests/components/location-input-wrapper.test.tsx`
- `tests/components/manual-coordinate-input.test.tsx`

**Modified:**
- `app/components/LocationInput.tsx` (renamed from old version, now wrapper)
- `app/components/AddressSearchInput.tsx` (renamed from old LocationInput.tsx)
- `app/chamber/ChamberClient.tsx` (updated handlers and state)
- `tests/chamber/organize-with-coordinates.test.ts` (added 2 new tests for Story 2.6)

**Deleted:**
- `tests/components/location-input-autocomplete.test.tsx` (obsolete, replaced)

### Change Log
| Date | Change | Reason |
|------|--------|--------|
| 2025-11-05 | Implemented two-field location input with mode toggle | Story 2.6 UX fix |
| 2025-11-05 | All tests passing, build successful | Ready for review |

### Status
Ready for Review

## QA Results

### Review Date: 2025-11-05

### Reviewed By: Quinn (Test Architect)

### Overall Assessment

**Story 2.6 is APPROVED for production.** This is a well-executed UX refinement that successfully addresses the core problem from Story 2.5: user location names being overwritten by Mapbox selections. The implementation demonstrates excellent software engineering practices with clean component separation, comprehensive test coverage, and proper state management.

**Quality Score: 95/100**

### Code Quality Assessment

#### Strengths

1. **Perfect Component Architecture**
   - Clean separation: LocationInput (wrapper) â†’ AddressSearchInput + ManualCoordinateInput
   - Single Responsibility Principle applied throughout
   - Props clearly defined with TypeScript interfaces

2. **Core UX Fix Successfully Implemented**
   - Location name field completely isolated from address/coordinate inputs
   - `handleAddressSelect` in ChamberClient.tsx (lines 50-62) correctly preserves locationName
   - User's personal labels now immune to Mapbox overwrites âœ“

3. **Comprehensive Validation**
   - Latitude validation: -90 to 90 (ManualCoordinateInput.tsx:25-29)
   - Longitude validation: -180 to 180 (ManualCoordinateInput.tsx:31-35)
   - Required field enforcement via Zod schema (organization.ts:17-29)
   - Real-time validation feedback with clear error messages

4. **Excellent Test Coverage (22 tests, 100% AC coverage)**
   - Wrapper component: 7 tests validating two-field behavior and mode toggle
   - Manual coordinates: 7 tests including edge cases (90, -180)
   - Organize API: 8 tests validating schema and Story 2.6 requirements

5. **Accessibility Compliance (WCAG 2.1 AA)**
   - Proper `<label>` elements with `htmlFor` associations
   - ARIA attributes on combobox (AddressSearchInput.tsx:123-127)
   - Keyboard navigation support (arrow keys, enter, escape)
   - Validation errors announced to screen readers

6. **State Management Clarity**
   - `locationName` state separate from `addressSearch`
   - Mode toggle (`coordinateMode`) cleanly switches between search/manual
   - No state pollution between realm changes

### Refactoring Performed

**None required.** The code is already at production quality. Only minor cleanup opportunities identified for future consideration (see below).

### Compliance Check

- âœ… **Coding Standards**: TypeScript typing, component patterns, naming conventions all excellent
- âœ… **Project Structure**: Files properly organized in `app/components/` and `tests/components/`
- âœ… **Testing Strategy**: Vitest unit tests with proper mocking, descriptive test names
- âœ… **All ACs Met**: 10/10 acceptance criteria fully implemented and validated

### Requirements Traceability Matrix

| AC# | Requirement | Test Coverage | Status |
|-----|-------------|---------------|--------|
| 1 | Two separate input fields | location-input-wrapper.test.tsx | âœ… |
| 2 | Location name field (required, never overwritten) | location-input-wrapper.test.tsx (lines 71-103) | âœ… |
| 3 | Address/coordinates field (optional, two modes) | location-input-wrapper.test.tsx + manual tests | âœ… |
| 4 | Mapbox selection preserves location name | location-input-wrapper.test.tsx (lines 71-103) | âœ… |
| 5 | Manual coordinate entry with validation | manual-coordinate-input.test.tsx (7 tests) | âœ… |
| 6 | UI mode toggle | location-input-wrapper.test.tsx (lines 105-130) | âœ… |
| 7 | Database storage (location_name, lat/lng, formatted_address) | organize-with-coordinates.test.ts (lines 335-427) | âœ… |
| 8 | Backward compatibility | No migration required, existing tests pass | âœ… |
| 9 | Warning messages | ChamberClient.tsx:102-105, ManualCoordinateInput.tsx:100-103 | âœ… |
| 10 | State management (locationName isolated) | location-input-wrapper.test.tsx (lines 132-154) | âœ… |

**Coverage: 10/10 ACs (100%)**

### Security Review

âœ… **No security concerns identified.**

- Input validation present for coordinate ranges (prevents injection of invalid data)
- No user-provided content rendered without sanitization
- Mapbox API key properly stored in environment variables (inherited from Story 2.5)

### Performance Considerations

âœ… **No performance impact.**

- Minimal state additions (addressSearch, coordinateMode)
- Mapbox debounce maintained (300ms, AddressSearchInput.tsx:54)
- Component split improves code maintainability without runtime cost

### Non-Functional Requirements (NFRs)

| NFR | Status | Notes |
|-----|--------|-------|
| Security | **PASS** | Input validation, no injection vectors |
| Performance | **PASS** | Minimal state, debounced API calls |
| Reliability | **PASS** | Graceful degradation when coords missing |
| Maintainability | **PASS** | Excellent component separation, clear naming |

### Improvements Checklist

All critical items already addressed by the developer. Only minor cleanup opportunities remain:

- [x] ~~Core UX fix: Location name preservation~~ (COMPLETED)
- [x] ~~Component separation~~ (COMPLETED)
- [x] ~~Comprehensive test coverage~~ (COMPLETED)
- [x] ~~Validation for manual coordinates~~ (COMPLETED)
- [ ] **Optional:** Remove unused `LocationData` interface from LocationInput.tsx (lines 7-12)
- [ ] **Optional:** Consider extracting coordinate validation to shared utility if reused elsewhere

### Files Modified During Review

**None.** No refactoring required - code is production-ready as-is.

### Gate Status

**Gate: PASS** â†’ `docs/qa/gates/2.6-location-name-address-separation.yml`

**Quality Score: 95/100**

**Decision Rationale:**
- All 10 acceptance criteria met with comprehensive test coverage
- Core UX problem (location name overwriting) successfully solved
- Clean, maintainable implementation with excellent separation of concerns
- No security, performance, or reliability concerns
- Only minor cleanup opportunities (unused interface) - non-blocking

### Test Execution Summary

```
âœ“ tests/chamber/organize-with-coordinates.test.ts (8 tests) 33ms
âœ“ tests/components/location-input-wrapper.test.tsx (7 tests) 929ms
âœ“ tests/components/manual-coordinate-input.test.tsx (7 tests) 2158ms

Test Files: 3 passed (3)
Tests: 22 passed (22)
Duration: 9.84s
```

**All tests passing. âœ…**

### Recommended Status

**âœ… Ready for Done**

This story is complete and ready for production deployment. The implementation successfully addresses the UX limitation from Story 2.5 and sets a strong foundation for future location-based features.

**Next Steps:**
1. Developer can mark story status as "Done"
2. Deploy to production with confidence
3. Monitor user feedback on the two-field location input experience
