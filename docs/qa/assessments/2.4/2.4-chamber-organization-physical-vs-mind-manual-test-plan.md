# Manual Test Plan: Story 2.4 - Chamber Organization (Physical vs Mind)

**Story**: 2.4-chamber-organization-physical-vs-mind
**Date Created**: 2025-11-04
**Created By**: Quinn (Test Architect)
**Status**: Ready for Execution

## Test Environment Setup

### Prerequisites
1. ‚úì Application running locally or in test environment
2. ‚úì Test user account created and logged in
3. ‚úì At least 5 unorganized somethings in database (realm IS NULL)
4. ‚úì At least 2 somethings with multi-line text (for split testing)
5. ‚úì At least 1 something with media (photo or video)
6. ‚úì Clean browser cache before starting

### Test Data Requirements
```sql
-- Verify you have unorganized somethings
SELECT COUNT(*) FROM somethings WHERE realm IS NULL;

-- Create test somethings if needed (via capture page or SQL)
INSERT INTO somethings (user_id, text_content, realm, domain, captured_at)
VALUES
  ('[your-user-id]', 'Coffee at Blue Bottle downtown', NULL, 'abode', NOW()),
  ('[your-user-id]', 'Reflection on AI consciousness', NULL, 'abode', NOW()),
  ('[your-user-id]', 'Walk in Golden Gate Park', NULL, 'abode', NOW());
```

---

## Test Scenarios

### TS-01: Physical Experience Organization (Happy Path)

**Priority**: P0 (Critical)
**AC Coverage**: AC1, AC2, AC4, AC5, AC6, AC10

**Steps**:
1. Navigate to `/dashboard`
2. Verify "Enter the Chamber" gemstone button is visible
3. Click "Enter the Chamber" button
4. Verify Chamber page loads with first unorganized something
5. Locate organization section (below split controls if present)
6. Select "Physical Experience" radio button
7. Verify location input field appears
8. Enter location: "Blue Bottle Coffee, Palo Alto"
9. Select care rating: Click on "üòç Beautiful" (4/5)
10. Verify "Organize & Continue" button is enabled
11. Click "Organize & Continue" button
12. Verify loading state appears briefly (button disabled, "Organizing..." text)
13. Verify page refreshes and shows next unorganized something (or empty state if none)

**Expected Results**:
- ‚úì Physical experience saved with realm='physical'
- ‚úì Location name saved correctly
- ‚úì Care rating saved as 4
- ‚úì Something no longer appears in Chamber queue
- ‚úì Dashboard "Organized" section shows the organized something
- ‚úì Next something loaded via FIFO (oldest first)

**Database Verification**:
```sql
SELECT id, realm, location_name, care, updated_at
FROM somethings
WHERE text_content = '[your-text-content]';
-- Expected: realm='physical', location_name='Blue Bottle Coffee, Palo Alto', care=4
```

---

### TS-02: Mind Experience Organization with Tags (Happy Path)

**Priority**: P0 (Critical)
**AC Coverage**: AC1, AC3, AC4, AC5, AC7, AC10

**Steps**:
1. In Chamber page (with unorganized something loaded)
2. Select "Mind Experience" radio button
3. Verify tags input field appears
4. Enter tags: "reflection, consciousness, AI"
5. Select care rating: Click on "‚ú® Love" (5/5)
6. Verify mind-specific emoji labels (Hate ‚Üí Love)
7. Click "Organize & Continue" button
8. Verify page refreshes and shows next unorganized something

**Expected Results**:
- ‚úì Mind experience saved with realm='mind'
- ‚úì Care rating saved as 5
- ‚úì Three tags created/linked: "reflection", "consciousness", "ai" (lowercase)
- ‚úì Something no longer in Chamber queue
- ‚úì Tags visible in dashboard or detail view

**Database Verification**:
```sql
-- Check something organized
SELECT id, realm, care FROM somethings WHERE text_content = '[your-text-content]';
-- Expected: realm='mind', care=5

-- Check tags created
SELECT name FROM tags WHERE user_id = '[your-user-id]' AND name IN ('reflection', 'consciousness', 'ai');
-- Expected: 3 rows

-- Check tag linkage
SELECT COUNT(*) FROM something_tags WHERE something_id = '[something-id]';
-- Expected: 3
```

---

### TS-03: Mind Experience without Tags

**Priority**: P1
**AC Coverage**: AC3, AC7

**Steps**:
1. In Chamber page
2. Select "Mind Experience" radio button
3. Leave tags input field empty
4. Select care rating: "üòä Neutral" (3/5)
5. Click "Organize & Continue" button

**Expected Results**:
- ‚úì Mind experience saved successfully
- ‚úì realm='mind', care=3
- ‚úì No tags created or linked
- ‚úì No errors shown

---

### TS-04: Care Slider Functionality (All Values)

**Priority**: P0
**AC Coverage**: AC4

**Steps**:
1. In Chamber page
2. Select "Physical Experience"
3. Test each care value by clicking emojis:
   - Click "üòû Ugly" (1/5) ‚Üí Verify selected (highlighted)
   - Click "üòê Meh" (2/5) ‚Üí Verify selected
   - Click "üòä OK" (3/5) ‚Üí Verify selected
   - Click "üòç Beautiful" (4/5) ‚Üí Verify selected
   - Click "‚ú® Stunning" (5/5) ‚Üí Verify selected
4. Switch to "Mind Experience"
5. Verify labels change:
   - "üòû Hate" (1/5)
   - "üòê Dislike" (2/5)
   - "üòä Neutral" (3/5)
   - "üòç Like" (4/5)
   - "‚ú® Love" (5/5)

**Expected Results**:
- ‚úì Each click updates selection (visual highlight)
- ‚úì Only one emoji selected at a time
- ‚úì Labels match realm type (Ugly‚ÜíBeautiful for physical, Hate‚ÜíLove for mind)
- ‚úì Accessible keyboard navigation works (Tab + Enter/Space)

---

### TS-05: Validation - No Realm Selected

**Priority**: P0
**AC Coverage**: AC11, AC12

**Steps**:
1. In Chamber page
2. Do NOT select Physical or Mind radio button
3. Click "Organize & Continue" button

**Expected Results**:
- ‚úì Error message displayed: "Please select Physical or Mind experience type"
- ‚úì Form not submitted
- ‚úì No page refresh
- ‚úì Error message disappears when realm selected

---

### TS-06: Validation - Physical without Location

**Priority**: P0
**AC Coverage**: AC2, AC11, AC12

**Steps**:
1. In Chamber page
2. Select "Physical Experience" radio button
3. Leave location input field empty
4. Select care rating: 3
5. Click "Organize & Continue" button

**Expected Results**:
- ‚úì Error message displayed: "Please enter a location for Physical experiences"
- ‚úì Form not submitted
- ‚úì Location input field remains visible and focused

---

### TS-07: Conditional UI Rendering

**Priority**: P0
**AC Coverage**: AC2, AC3

**Steps**:
1. In Chamber page
2. Verify neither location nor tags inputs are visible initially
3. Select "Physical Experience"
   - Verify location input appears
   - Verify tags input does NOT appear
4. Select "Mind Experience"
   - Verify tags input appears
   - Verify location input does NOT appear
5. Switch back to "Physical Experience"
   - Verify location input appears again
   - Verify previous location value cleared (fresh state)

**Expected Results**:
- ‚úì Conditional rendering works correctly
- ‚úì Only appropriate input shown based on selection
- ‚úì Smooth transitions (no flickering)

---

### TS-08: Empty Chamber State

**Priority**: P0
**AC Coverage**: AC9

**Steps**:
1. Organize all unorganized somethings until none remain
2. Verify empty chamber state displays:
   - ‚ú® icon
   - "Chamber is Empty" heading
   - "All captures organized!" message
   - "Your reality awaits..." motivational text
   - "Return to Dashboard" button
3. Click "Return to Dashboard" button

**Expected Results**:
- ‚úì Empty state UI displays correctly
- ‚úì No errors or broken UI
- ‚úì Button navigates back to /dashboard
- ‚úì Dashboard shows no unorganized count (or 0)

---

### TS-09: Loading States

**Priority**: P1
**AC Coverage**: AC13

**Steps**:
1. In Chamber page with something to organize
2. Fill form (Physical, location, care)
3. Open browser DevTools Network tab
4. Throttle network to "Slow 3G"
5. Click "Organize & Continue" button
6. Observe loading behavior:
   - Button text changes to "Organizing..."
   - Button disabled during request
   - Form inputs disabled
   - Optional: Loading spinner visible

**Expected Results**:
- ‚úì Clear loading feedback
- ‚úì User cannot submit again during processing
- ‚úì Form locked during submission
- ‚úì No double-submission possible

---

### TS-10: Error Handling - Network Error

**Priority**: P1
**AC Coverage**: AC12

**Steps**:
1. In Chamber page
2. Fill form correctly (Physical, location, care)
3. Disconnect from network (or use DevTools to simulate offline)
4. Click "Organize & Continue" button
5. Wait for error

**Expected Results**:
- ‚úì Error message displayed: "Network error. Please try again."
- ‚úì Form remains filled (user doesn't lose data)
- ‚úì Form re-enabled (user can retry)
- ‚úì No page crash

---

### TS-11: Split Integration - Layout

**Priority**: P0
**AC Coverage**: AC15

**Steps**:
1. Create/find something with multi-line text (for split eligibility)
2. Navigate to Chamber page
3. Verify layout structure:
   - Split controls at top (checkbox visible)
   - Visual separator ("‚Äî OR ORGANIZE ‚Äî")
   - Organization controls below
4. Verify both sections independently functional

**Expected Results**:
- ‚úì Clear visual separation between split and organize
- ‚úì Split checkbox functional (from Story 2.2)
- ‚úì Organization controls functional
- ‚úì No UI overlap or confusion

---

### TS-12: Split Integration - Split Then Organize Workflow

**Priority**: P0
**AC Coverage**: AC15, AC16

**Steps**:
1. In Chamber with multi-line something
2. Check split checkbox ‚Üí Open split modal
3. Split into 2 parts (distribute text)
4. Submit split
5. Verify page refreshes, shows next unorganized (NOT split children immediately)
6. Organize current something (Physical, location, care)
7. Continue organizing until split children appear
8. Verify split children can be organized normally

**Expected Results**:
- ‚úì Split creates parent (realm='split') and children (realm=NULL)
- ‚úì After split, NEXT unorganized shown (FIFO order)
- ‚úì Split children appear later in queue (oldest first)
- ‚úì Split children organize like any other something
- ‚úì Split parent never appears in Chamber queue

---

### TS-13: Split Parent Exclusion

**Priority**: P0
**AC Coverage**: AC17

**Steps**:
1. Verify split parent exists in database:
```sql
SELECT id, realm, text_content FROM somethings WHERE realm='split';
-- Should see records like "[Split into N parts]"
```
2. Navigate through Chamber, organizing all somethings
3. Verify split parent NEVER appears in Chamber

**Expected Results**:
- ‚úì Split parents completely excluded from Chamber
- ‚úì Query filters realm IS NULL (excludes realm='split')
- ‚úì Cannot accidentally organize split parent placeholder

**Negative Test**: Attempt to organize split parent via API
```bash
curl -X PATCH http://localhost:3000/api/somethings/[split-parent-id]/organize \
  -H "Content-Type: application/json" \
  -d '{"realm":"physical","care":3,"location_name":"Test"}'
```
**Expected**: 403 error "Cannot organize split parent placeholder"

---

### TS-14: Tag Normalization and Deduplication

**Priority**: P1
**AC Coverage**: AC7

**Steps**:
1. In Chamber page
2. Select "Mind Experience"
3. Enter tags with various formats:
   - "Coffee, COFFEE, coffee , CoFfEe"
   - "   spaces   , trim-test"
4. Set care rating: 3
5. Click "Organize & Continue"

**Expected Results**:
- ‚úì Duplicate tags deduplicated ("coffee" appears only once)
- ‚úì Tags normalized to lowercase
- ‚úì Leading/trailing spaces trimmed
- ‚úì Only one tag record created for "coffee"
- ‚úì One tag created for "spaces", one for "trim-test"

**Database Verification**:
```sql
SELECT DISTINCT name FROM tags WHERE user_id = '[your-user-id]' AND name IN ('coffee', 'spaces', 'trim-test');
-- Expected: 3 rows (coffee, spaces, trim-test)
```

---

### TS-15: Tag Reuse (Existing Tags)

**Priority**: P1
**AC Coverage**: AC7

**Steps**:
1. Organize first mind something with tags: "coffee, reflection"
2. Organize second mind something with tags: "coffee, insight"
3. Organize third mind something with tag: "coffee"

**Expected Results**:
- ‚úì "coffee" tag created only once
- ‚úì All three somethings linked to same "coffee" tag
- ‚úì "reflection" tag created once
- ‚úì "insight" tag created once
- ‚úì No duplicate tag records

**Database Verification**:
```sql
-- Should see only 3 unique tags
SELECT id, name FROM tags WHERE user_id = '[your-user-id]' AND name IN ('coffee', 'reflection', 'insight');
-- Expected: 3 rows

-- Should see 'coffee' linked to 3 somethings
SELECT COUNT(*) FROM something_tags st
JOIN tags t ON st.tag_id = t.id
WHERE t.name = 'coffee' AND t.user_id = '[your-user-id]';
-- Expected: 3
```

---

### TS-16: Long Location Names

**Priority**: P2 (Edge Case)
**AC Coverage**: AC6

**Steps**:
1. In Chamber page
2. Select "Physical Experience"
3. Enter very long location name (500+ characters):
   "This is an extremely long location name that tests the database field limit and UI rendering behavior. It includes many words and should test whether the system handles very verbose location descriptions gracefully without crashing or truncating data unexpectedly..."
4. Set care: 3
5. Click "Organize & Continue"

**Expected Results**:
- ‚úì Location saved without truncation (or graceful truncation if limit exists)
- ‚úì No database errors
- ‚úì UI doesn't break when displaying long names

---

### TS-17: Special Characters in Location and Tags

**Priority**: P2 (Edge Case)
**AC Coverage**: AC6, AC7

**Steps**:
1. Test location with special characters:
   - Location: "Caf√© Z√ºrich (Main St.) & Co."
   - Organize as Physical
2. Test tags with special characters:
   - Tags: "work/life, balance!, #productivity, $financial"
   - Organize as Mind

**Expected Results**:
- ‚úì Special characters saved correctly (no encoding issues)
- ‚úì UTF-8 characters handled (√©, √º)
- ‚úì Punctuation preserved
- ‚úì No SQL injection possible
- ‚úì Tags normalized properly with special chars

---

### TS-18: Accessibility Testing

**Priority**: P1
**AC Coverage**: AC4

**Steps**:
1. In Chamber page
2. Use ONLY keyboard (no mouse):
   - Tab to "Physical Experience" radio button ‚Üí Press Enter
   - Tab to location input ‚Üí Type location
   - Tab to care slider ‚Üí Use arrow keys / Tab + Enter to select care
   - Tab to "Organize & Continue" button ‚Üí Press Enter
3. Use screen reader (if available):
   - Verify all form labels announced
   - Verify care slider aria-labels read correctly
   - Verify error messages announced

**Expected Results**:
- ‚úì All form controls keyboard accessible
- ‚úì Focus indicators visible
- ‚úì Logical tab order
- ‚úì Aria labels correct
- ‚úì Screen reader usable

---

### TS-19: Multi-User Isolation

**Priority**: P0 (Security)
**AC Coverage**: AC10, AC11

**Steps**:
1. Login as User A
2. Create unorganized something
3. Note something ID
4. Login as User B (different browser/incognito)
5. Attempt to organize User A's something via API:
```bash
curl -X PATCH http://localhost:3000/api/somethings/[user-a-something-id]/organize \
  -H "Content-Type: application/json" \
  -H "Cookie: [user-b-session-cookie]" \
  -d '{"realm":"physical","care":3,"location_name":"Test"}'
```

**Expected Results**:
- ‚úì 404 error "Something not found or access denied"
- ‚úì User A's something NOT modified
- ‚úì User B cannot see User A's somethings in Chamber

---

### TS-20: Concurrent Organization (Race Condition)

**Priority**: P2
**AC Coverage**: AC10

**Steps**:
1. Open Chamber in two browser tabs (same user)
2. Both tabs show same unorganized something
3. In Tab 1: Start organizing (Physical, location, care), click submit
4. Quickly in Tab 2: Organize same something (Mind, tags, care), click submit
5. Observe behavior

**Expected Results**:
- ‚úì One request succeeds, one may fail (acceptable)
- ‚úì Something organized with one set of data (not corrupted)
- ‚úì Both tabs refresh to next something
- ‚úì No database corruption
- ‚úì No duplicate organization

---

## Smoke Test Suite (Quick Validation)

**Time Required**: ~10 minutes

Run this after any code changes to Story 2.4:

1. ‚úì **Happy Path Physical**: Organize one physical experience with location and care
2. ‚úì **Happy Path Mind**: Organize one mind experience with tags and care
3. ‚úì **Validation**: Try to organize without selecting realm (should fail with error)
4. ‚úì **Empty State**: Organize all somethings, verify empty state displays
5. ‚úì **Split Integration**: Split one something, verify organization still works on next

**Pass Criteria**: All 5 tests pass without errors

---

## Regression Test Suite (Before Production)

**Time Required**: ~45 minutes

Run full test suite (TS-01 through TS-19) before deploying to production:

- [ ] TS-01: Physical Organization (Happy Path)
- [ ] TS-02: Mind Organization with Tags (Happy Path)
- [ ] TS-03: Mind without Tags
- [ ] TS-04: Care Slider All Values
- [ ] TS-05: Validation - No Realm
- [ ] TS-06: Validation - No Location
- [ ] TS-07: Conditional UI
- [ ] TS-08: Empty Chamber State
- [ ] TS-09: Loading States
- [ ] TS-10: Network Error Handling
- [ ] TS-11: Split Layout
- [ ] TS-12: Split Then Organize
- [ ] TS-13: Split Parent Exclusion
- [ ] TS-14: Tag Normalization
- [ ] TS-15: Tag Reuse
- [ ] TS-16: Long Location Names
- [ ] TS-17: Special Characters
- [ ] TS-18: Accessibility
- [ ] TS-19: Multi-User Isolation
- [ ] TS-20: Concurrent Organization

**Pass Criteria**: All P0 and P1 tests pass. P2 tests should pass but can be waived with documentation.

---

## Known Issues / Limitations

1. **visited field**: Not implemented (field doesn't exist in current schema). AC6 mentions setting `visited=true` for physical somethings, but this is not implemented. Documented in code comment.

2. **Tag Processing Error Silencing**: If tag creation fails, the something is still organized successfully, but tags are silently dropped. User is not notified. This is acceptable for MVP (main operation succeeded), but consider showing warning in future.

3. **No Rate Limiting**: API endpoint has no rate limiting. Acceptable for MVP with authenticated users, but consider adding for production.

---

## Test Results Template

```
Test Execution Date: ___________
Tester Name: ___________
Environment: [ ] Local [ ] Test [ ] Staging

| Test ID | Test Name | Status | Notes |
|---------|-----------|--------|-------|
| TS-01 | Physical Happy Path | [ ] PASS [ ] FAIL |  |
| TS-02 | Mind Happy Path | [ ] PASS [ ] FAIL |  |
| ... | ... | ... | ... |

Summary:
- Total Tests: ___
- Passed: ___
- Failed: ___
- Blocked: ___

Critical Issues Found:
1. ...

Non-Critical Issues Found:
1. ...

Overall Assessment: [ ] PASS [ ] FAIL [ ] CONCERNS
```

---

**Test Plan Maintenance**: Update this document when:
- New acceptance criteria added
- Edge cases discovered
- Known issues resolved
- New browsers/devices need testing
